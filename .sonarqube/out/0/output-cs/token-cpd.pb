Ã
S/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Logic/Platform.cs
	namespace 	

TrainTimes
 
. 
Logic 
{ 
public 

class 
Platform 
{ 
public 
string 
? 
name 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
number 
{ 
get  #
;# $
set% (
;( )
}* +
public 
List 
< 
StationArrival "
>" #
?# $
arrivals% -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
}

 
} ‰
Z/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Logic/StationArrivals.cs
	namespace 	

TrainTimes
 
. 
Logic 
{ 
public		 

class		 
StationArrivals		  
{

 
private 
	TflClient 
client  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
StationArrivals 
( 
)  
{ 	
client 
= 
new 
	TflClient "
(" #
$str# <
)< =
;= >
} 	
public 
async 
Task 
< 

Dictionary $
<$ %
string% +
,+ ,
List- 1
<1 2
StationArrival2 @
>@ A
>A B
>B C 
GetPlatformsArrivalsD X
(X Y
stringY _
stationName` k
)k l
{ 	
try 
{ 

Dictionary 
< 
string !
,! "
List# '
<' (
StationArrival( 6
>6 7
>7 8
platformsArrivals9 J
=K L
awaitM R
clientS Y
.Y Z&
GetStationPlatformArrivalsZ t
(t u
stationName	u Ä
)
Ä Å
;
Å Ç
return 
platformsArrivals (
;( )
} 
catch 
( &
JsonSerializationException -
ex. 0
)0 1
{ 
throw 
new &
JsonSerializationException 4
(4 5
ex5 7
.7 8
Message8 ?
)? @
;@ A
} 
} 	
} 
} •
W/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Pages/Error.cshtml.cs
	namespace 	

TrainTimes
 
. 
Pages 
{ 
[ 
ResponseCache 
( 
Duration 
= 
$num 
,  
Location! )
=* +!
ResponseCacheLocation, A
.A B
NoneB F
,F G
NoStoreH O
=P Q
trueR V
)V W
]W X
public

 

class

 

ErrorModel

 
:

 
	PageModel

 '
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
private 
readonly 
ILogger  
<  !

ErrorModel! +
>+ ,
_logger- 4
;4 5
public 
ILogger 
< 

ErrorModel !
>! "
Logger# )
{ 	
get 
{ 
return 
_logger 
; 
} 
} 	
public 

ErrorModel 
( 
ILogger !
<! "

ErrorModel" ,
>, -
logger. 4
)4 5
{ 	
_logger 
= 
logger 
; 
} 	
public!! 
void!! 
OnGet!! 
(!! 
)!! 
{"" 	
	RequestId## 
=## 
Activity##  
.##  !
Current##! (
?##( )
.##) *
Id##* ,
??##- /
HttpContext##0 ;
.##; <
TraceIdentifier##< K
;##K L
}$$ 	
}%% 
}&& Ö
W/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Pages/Index.cshtml.cs
	namespace 	

TrainTimes
 
. 
Pages 
{ 
public		 

class		 

IndexModel		 
:		 
	PageModel		 '
{

 
public 

Dictionary 
< 
string  
,  !
List" &
<& '
StationArrival' 5
>5 6
>6 7
?7 8
allPlatformArrivals9 L
{M N
getO R
;R S
setT W
;W X
}Y Z
public 
List 
< 
string 
> 
? 
platformNames *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
string 
? 
stationName "
{# $
get% (
;( )
set* -
;- .
}/ 0
private 
StationArrivals 
_allArrivals  ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
private 
readonly 
ILogger  
<  !

IndexModel! +
>+ ,
_logger- 4
;4 5
public 
ILogger 
< 

IndexModel !
>! "
Logger# )
{ 	
get 
{ 
return 
_logger 
; 
} 
} 	
public 

IndexModel 
( 
ILogger !
<! "

IndexModel" ,
>, -
logger. 4
)4 5
{ 	
_logger 
= 
logger 
; 
_allArrivals 
= 
new 
StationArrivals .
(. /
)/ 0
;0 1
}!! 	
public## 
async## 
Task## 
OnGet## 
(##  
)##  !
{$$ 	
this%% 
.%% 
allPlatformArrivals%% $
=%%% &
await%%' ,
_allArrivals%%- 9
.%%9 : 
GetPlatformsArrivals%%: N
(%%N O
$str%%O [
)%%[ \
;%%\ ]
this&& 
.&& 
platformNames&& 
=&&  
allPlatformArrivals&&! 4
.&&4 5
Keys&&5 9
.&&9 :
ToList&&: @
(&&@ A
)&&A B
;&&B C
this'' 
.'' 
stationName'' 
='' 
allPlatformArrivals'' 2
[''2 3
platformNames''3 @
[''@ A
$num''A B
]''B C
]''C D
.''D E
First''E J
(''J K
)''K L
.''L M
stationName''M X
;''X Y
}(( 	
}++ 
},, Ê
Y/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Pages/Privacy.cshtml.cs
	namespace 	

TrainTimes
 
. 
Pages 
{ 
public 

class 
PrivacyModel 
: 
	PageModel  )
{ 
private 
readonly 
ILogger  
<  !
PrivacyModel! -
>- .
_logger/ 6
;6 7
public

 
PrivacyModel

 
(

 
ILogger

 #
<

# $
PrivacyModel

$ 0
>

0 1
logger

2 8
)

8 9
{ 	
_logger 
= 
logger 
; 
} 	
public 
ILogger 
< 
PrivacyModel #
># $
Logger% +
{ 	
get 
{ 
return 
_logger 
; 
} 
} 	
public 
void 
OnGet 
( 
) 
{ 	
} 	
} 
} Û

L/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddRazorPages 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if		 
(		 
!		 
app		 
.		 	
Environment			 
.		 
IsDevelopment		 "
(		" #
)		# $
)		$ %
{

 
app 
. 
UseExceptionHandler 
( 
$str $
)$ %
;% &
} 
app 
. 
UseStaticFiles 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app 
. 
UseAuthorization 
( 
) 
; 
app 
. 
MapRazorPages 
( 
) 
; 
app 
. 
Run 
( 
) 	
;	 
∞
X/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/WebAPI/SearchResult.cs
	namespace 	

TrainTimes
 
. 
WebAPI 
{ 
public 

class 
Match 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
string 
? 
type 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
icsId 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
string		 
?		 
topMostParentId		 &
{		' (
get		) ,
;		, -
set		. 1
;		1 2
}		3 4
public

 
List

 
<

 
string

 
>

 
?

 
modes

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
string 
? 
zone 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
id 
{ 
get 
;  
set! $
;$ %
}& '
public 
string 
? 
name 
{ 
get !
;! "
set# &
;& '
}( )
public 
double 
? 
lat 
{ 
get  
;  !
set" %
;% &
}' (
public 
double 
? 
lon 
{ 
get  
;  !
set" %
;% &
}' (
} 
public 

class 
SearchResult 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
string 
? 
type 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
? 
query 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
? 
total 
{ 
get 
;  
set! $
;$ %
}& '
public 
List 
< 
Match 
> 
? 
matches #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} •+
Z/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/WebAPI/StationArrival.cs
	namespace 	

TrainTimes
 
. 
WebAPI 
{ 
public 

class 
StationArrival 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
string 
? 
type 
{ 
get !
;! "
set# &
;& '
}( )
[		 	
BindProperty			 
]		 
public

 
string

 
?

 
id

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 
int 
? 
operationType !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
? 
	vehicleId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 
naptanId 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
? 
stationName "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 
? 
lineId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
? 
lineName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
? 
platformName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
	direction  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
? 
bearing 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
? 
destinationNaptanId *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
string 
? 
destinationName &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DateTime 
? 
	timestamp "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
? 
timeToStation !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
? 
currentLocation &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
? 
towards 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
BindProperty	 
] 
public 
DateTime 
? 
expectedArrival (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DateTime 
? 

timeToLive #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
? 
modeName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
Timing 
? 
timing 
{ 
get  #
;# $
set% (
;( )
}* +
} 
public!! 

class!! 
Timing!! 
{"" 
[## 	
JsonProperty##	 
(## 
$str## 
)## 
]## 
public$$ 
string$$ 
?$$ 
type$$ 
{$$ 
get$$ !
;$$! "
set$$# &
;$$& '
}$$( )
public%% 
string%% 
?%% %
countdownServerAdjustment%% 0
{%%1 2
get%%3 6
;%%6 7
set%%8 ;
;%%; <
}%%= >
public&& 
DateTime&& 
?&& 
source&& 
{&&  !
get&&" %
;&&% &
set&&' *
;&&* +
}&&, -
public'' 
DateTime'' 
?'' 
insert'' 
{''  !
get''" %
;''% &
set''' *
;''* +
}'', -
public(( 
DateTime(( 
?(( 
read(( 
{(( 
get((  #
;((# $
set((% (
;((( )
}((* +
public)) 
DateTime)) 
?)) 
sent)) 
{)) 
get))  #
;))# $
set))% (
;))( )
}))* +
public** 
DateTime** 
?** 
received** !
{**" #
get**$ '
;**' (
set**) ,
;**, -
}**. /
}++ 
},, πP
U/Users/Hadleigh.Wallenberg/Documents/GitHub/TrainTimes/TrainTimes/WebAPI/TflClient.cs
	namespace 	

TrainTimes
 
. 
WebAPI 
{ 
public 

class 
	TflClient 
{ 
private		 
readonly		 

HttpClient		 #
_client		$ +
;		+ ,
public 
	TflClient 
( 
string 

TFLBaseURL  *
)* +
{ 	
_client 
= 
new 

HttpClient $
($ %
)% &
;& '
_client 
. 
BaseAddress 
=  !
new" %
Uri& )
() *

TFLBaseURL* 4
)4 5
;5 6
_client 
. !
DefaultRequestHeaders )
.) *
Accept* 0
.0 1
Add1 4
(4 5
new5 8+
MediaTypeWithQualityHeaderValue9 X
(X Y
$strY k
)k l
)l m
;m n
} 	
public 

HttpClient 
Client  
{ 	
get 
{ 
return 
_client  
;  !
}" #
} 	
public 
async 
Task 
< 
bool 
> 
connectToTFLService  3
(3 4
)4 5
{ 	
try 
{ 
string 
requestParams $
=% &
$str' K
;K L
HttpResponseMessage #
response$ ,
=- .
await/ 4
Client5 ;
.; <
GetAsync< D
(D E
requestParamsE R
)R S
;S T
return 
response 
.  
IsSuccessStatusCode  3
;3 4
} 
catch 
(  
HttpRequestException '
ex( *
)* +
{   
throw!! 
new!!  
HttpRequestException!! .
(!!. /
ex!!/ 1
.!!1 2
Message!!2 9
)!!9 :
;!!: ;
}"" 
}$$ 	
public&& 
async&& 
Task&& 
<&& 
string&&  
>&&  !
GetStationID&&" .
(&&. /
string&&/ 5
stationName&&6 A
)&&A B
{'' 	
SearchResult(( 
?(( 
searchResult(( &
=((' (
new(() ,
SearchResult((- 9
(((9 :
)((: ;
;((; <
string)) 
?)) 
	stationId)) 
=)) 
string))  &
.))& '
Empty))' ,
;)), -
try** 
{++ 
string,, 
requestParams,, $
=,,% &
$str,,' ;
+,,< =
stationName,,> I
+,,J K
$str,,L Z
;,,Z [
HttpResponseMessage-- #
response--$ ,
=--- .
await--/ 4
Client--5 ;
.--; <
GetAsync--< D
(--D E
requestParams--E R
)--R S
;--S T
searchResult.. 
=.. 
JsonConvert.. *
...* +
DeserializeObject..+ <
<..< =
SearchResult..= I
>..I J
(..J K
response..K S
...S T
Content..T [
...[ \
ReadAsStringAsync..\ m
(..m n
)..n o
...o p
Result..p v
)..v w
;..w x
if// 
(// 
searchResult//  
!=//! #
null//$ (
)//( )
{00 
if11 
(11 
searchResult11 $
.11$ %
matches11% ,
!=11- /
null110 4
)114 5
{22 
if33 
(33 
searchResult33 (
.33( )
matches33) 0
.330 1
Count331 6
==337 9
$num33: ;
)33; <
{44 
	stationId55 %
=55& '
searchResult55( 4
.554 5
matches555 <
[55< =
$num55= >
]55> ?
.55? @
id55@ B
;55B C
}66 
}77 
else88 
{99 
	stationId:: !
=::" #
$str::$ S
;::S T
};; 
}<< 
else== 
{>> 
throw?? 
new?? !
ArgumentNullException?? 3
(??3 4
$str??4 _
+??` a
stationName??b m
)??m n
;??n o
}@@ 
}AA 
catchBB 
(BB &
JsonSerializationExceptionBB -
exBB. 0
)BB0 1
{CC 
throwDD 
newDD &
JsonSerializationExceptionDD 4
(DD4 5
exDD5 7
.DD7 8
MessageDD8 ?
)DD? @
;DD@ A
}EE 
ifFF 
(FF 
	stationIdFF 
!=FF 
nullFF !
)FF! "
{GG 
returnHH 
	stationIdHH  
;HH  !
}II 
elseJJ 
{KK 
throwLL 
newLL !
ArgumentNullExceptionLL /
(LL/ 0
$strLL0 Q
+LLR S
stationNameLLT _
)LL_ `
;LL` a
}MM 
}NN 	
publicPP 
asyncPP 
TaskPP 
<PP 

DictionaryPP $
<PP$ %
stringPP% +
,PP+ ,
ListPP- 1
<PP1 2
StationArrivalPP2 @
>PP@ A
>PPA B
>PPB C&
GetStationPlatformArrivalsPPD ^
(PP^ _
stringPP_ e
stationNamePPf q
)PPq r
{QQ 	
ListRR 
<RR 
StationArrivalRR 
>RR  
?RR  !
arrivalsRR" *
=RR+ ,
newRR- 0
ListRR1 5
<RR5 6
StationArrivalRR6 D
>RRD E
(RRE F
)RRF G
;RRG H

DictionarySS 
<SS 
stringSS 
,SS 
ListSS #
<SS# $
StationArrivalSS$ 2
>SS2 3
>SS3 4
platformArrivalsSS5 E
;SSE F
stringTT 
	stationIDTT 
=TT 
awaitTT $
GetStationIDTT% 1
(TT1 2
stationNameTT2 =
)TT= >
;TT> ?
tryUU 
{VV 
stringWW 
requestParamsWW $
=WW% &
$strWW' 4
+WW5 6
	stationIDWW7 @
+WWA B
$strWWC Y
;WWY Z
HttpResponseMessageXX #
responseXX$ ,
=XX- .
awaitXX/ 4
ClientXX5 ;
.XX; <
GetAsyncXX< D
(XXD E
requestParamsXXE R
)XXR S
;XXS T
arrivalsYY 
=YY 
JsonConvertYY &
.YY& '
DeserializeObjectYY' 8
<YY8 9
ListYY9 =
<YY= >
StationArrivalYY> L
>YYL M
>YYM N
(YYN O
responseYYO W
.YYW X
ContentYYX _
.YY_ `
ReadAsStringAsyncYY` q
(YYq r
)YYr s
.YYs t
ResultYYt z
)YYz {
;YY| }
if[[ 
([[ 
arrivals[[ 
!=[[ 
null[[  $
)[[$ %
{\\ 
platformArrivals]] $
=]]% &
new]]' *

Dictionary]]+ 5
<]]5 6
string]]6 <
,]]< =
List]]> B
<]]B C
StationArrival]]C Q
>]]Q R
>]]R S
(]]S T
)]]T U
;]]U V
foreach^^ 
(^^ 
StationArrival^^ +
_arrival^^, 4
in^^5 7
arrivals^^8 @
)^^@ A
{__ 
if`` 
(`` 
_arrival`` $
.``$ %
platformName``% 1
!=``2 4
null``5 9
)``9 :
{aa 
ifbb 
(bb  
!bb  !
platformArrivalsbb! 1
.bb1 2
ContainsKeybb2 =
(bb= >
_arrivalbb> F
.bbF G
platformNamebbG S
)bbS T
)bbT U
{cc 
Listdd  $
<dd$ %
StationArrivaldd% 3
>dd3 4
stationArrivalsdd5 D
=ddE F
arrivalsddG O
.ddO P
WhereddP U
(ddU V
addV W
=>ddX Z
add[ \
.dd\ ]
platformNamedd] i
==ddj l
_arrivalddm u
.ddu v
platformName	ddv Ç
)
ddÇ É
.
ddÉ Ñ
ToList
ddÑ ä
(
ddä ã
)
ddã å
;
ddå ç
platformArrivalsff  0
.ff0 1
Addff1 4
(ff4 5
_arrivalff5 =
.ff= >
platformNameff> J
,ffJ K
stationArrivalsffL [
)ff[ \
;ff\ ]
}gg 
elsehh  
{ii 
Listjj  $
<jj$ %
StationArrivaljj% 3
>jj3 4
stationArrivalsjj5 D
=jjE F
platformArrivalsjjG W
[jjW X
_arrivaljjX `
.jj` a
platformNamejja m
]jjm n
;jjn o
stationArrivalskk  /
.kk/ 0
Addkk0 3
(kk3 4
_arrivalkk4 <
)kk< =
;kk= >
platformArrivalsll  0
[ll0 1
_arrivalll1 9
.ll9 :
platformNamell: F
]llF G
=llH I
stationArrivalsllJ Y
;llY Z
}mm 
}nn 
}oo 
}pp 
elseqq 
{rr 
throwss 
newss !
ArgumentNullExceptionss 3
(ss3 4
$strss4 j
+ssk l
	stationIDssm v
+ssw x
$str	ssy ä
+
ssã å
stationName
ssç ò
)
ssò ô
;
ssô ö
}tt 
}uu 
catchww 
(ww &
JsonSerializationExceptionww -
exww. 0
)ww0 1
{xx 
throwyy 
newyy &
JsonSerializationExceptionyy 4
(yy4 5
exyy5 7
.yy7 8
Messageyy8 ?
)yy? @
;yy@ A
}zz 
return|| 
platformArrivals|| #
;||# $
}~~ 	
} 
}ÄÄ 